(function(m){var l=window.AmazonUIPageJS||window.P,n=l._namespace||l.attributeErrors,p=n?n("VSECommonComponentAssets",""):l;p.guardFatal?p.guardFatal(m)(p,window):p.execute(function(){m(p,window)})})(function(m,l,n){(function(){function p(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var c=16*Math.random()|0;return("x"==a?c:c&3|8).toString(16)})}l.vseFeatures=l.vseFeatures||{};var y=l.gatedP||{register:function(a,c,e,d,f){void 0===f&&(f=l.vseFeatures);m.now(a).execute(a+
"-prereg",function(g){g||f[c]||(f[c]=!0,d.resolve(e(d)).then(function(){m.now(a).execute(a+"-reg",function(e){e||(m.log("Gated registration failed to register module!","ERROR",a),f[c]=!1)})}))})},declare:function(a,c,e,d){void 0===d&&(d=l.vseFeatures);m.now(a).execute(a+"-prereg",function(f){f||d[c]||(d[c]=!0,m.declare(a,e))})}},r={count:function(a,c){var e=l.ue;e&&e.count("vse:csm:"+a,c)},emitSushiMetric:function(a,c,e){var d=this;c=c||"https://unagi-na.amazon.com/1/events/com.amazon.eel.vse.metricstest.nexus";
e=e||0;if(!(3<=e)){var f=JSON.stringify(a).replace(/\\\\/g,""),g={params:f,paramsFormat:"json",contentType:"application/json; charset\x3dutf-8",error:function(){d.emitSushiMetric(a,c,++e)}},h=navigator.userAgent.match(/iPhone/i),k=!1;m.now("mash").execute("vse-detect-mshop",function(){k=!0});var G=null!==h&&k;m.when("A").execute("Emit-VSE-Metrics",function(a){navigator&&navigator.sendBeacon&&!G?navigator.sendBeacon(c,f):a.post(c,g)})}}},H={makeApplicationSushiPayloadBuilder:function(a,c){return function(e){var d=
{eventSource:c.eventSource,requestId:c.requestId,sessionId:c.sessionId,placementContext:c.placementContext,marketplaceId:c.marketplaceId,weblabIds:c.weblabIds,clientId:c.clientId,isInternal:c.isInternal.toString(),isRobot:c.isRobot.toString(),pageAsin:c.pageAsin,customerId:c.customerId,sessionType:c.sessionType||1,refMarkers:c.refMarkers,eventId:p(),timestamp:new Date,userAgentData:navigator.userAgent,titleSessionId:0,videoAsin:0};return{events:[{data:a.$.extend(d,e)}]}}}},I={fetchLatestPageState:function(a,
c){a.state.replace(c,JSON.parse(a.$("script[type\x3d'a-state'][data-a-state*\x3d"+c+"]").html()));return a.state(c)}},J=function(){function a(c,b){void 0===b&&(b={refTagRecorderEndPoint:"/gp/mobile/tag/",retryLimit:3});this.A=c;this.config=b}a.prototype.emitRefTag=function(a,b,d){void 0===d&&(d=0);if(!(d>=this.config.retryLimit)){var f=this;this.A.post(this.config.refTagRecorderEndPoint+"ref\x3d"+a+(b.enableAssociateTag?"?tag\x3dospatk-20\x26linkCode\x3dvse\x26creativeASIN\x3d"+b.productAsin+"\x26ascsubtag\x3d"+
b.contentId:""),{error:function(){f.emitRefTag(a,b,++d)}})}};return a}(),g=function(){function a(){}a.POSITIVE_VOTE="positive";a.NEGATIVE_VOTE="negative";a.NONE_VOTE="none";a.EMPTY_STRING="";return a}(),u=function(){function a(c,b){this.element=c;this.videoVoteConfig=b;this.countsFetched=!1;this.positiveVoteCount=0;this.showPositiveVotes=!1;this.negativeVoteCount=0;this.showNegativeVotes=!1;this.prompt=c.find(".vse-vote-helpful-text");this.positiveVoteText=c.find(".vse-vote-positive");this.positiveVoteIcon=
c.find(".vse-vote-positive-icon");this.negativeVoteText=c.find(".vse-vote-negative");this.negativeVoteIcon=c.find(".vse-vote-negative-icon");this.previousVote=g.EMPTY_STRING}a.prototype.getVoteCount=function(a){return a===g.POSITIVE_VOTE?this.positiveVoteCount:a===g.NEGATIVE_VOTE?this.negativeVoteCount:0};a.prototype.setVoteCount=function(a,b){0>b&&(b=0);a===g.POSITIVE_VOTE?(this.positiveVoteCount=b,this.positiveVoteText.html(String(b))):a===g.NEGATIVE_VOTE&&(this.negativeVoteCount=b,this.negativeVoteText.html(String(b)));
this.element.addClass("updated")};a.prototype.getPreviousVote=function(){return this.previousVote};a.prototype.setPreviousVote=function(a){if(a===g.POSITIVE_VOTE)this.positiveVoteIcon.addClass("hasvoted"),this.negativeVoteIcon.removeClass("hasvoted"),0>=this.getVoteCount(g.POSITIVE_VOTE)&&this.setVoteCount(g.POSITIVE_VOTE,1);else if(a===g.NEGATIVE_VOTE)this.negativeVoteIcon.addClass("hasvoted"),this.positiveVoteIcon.removeClass("hasvoted"),0>=this.getVoteCount(g.NEGATIVE_VOTE)&&this.setVoteCount(g.NEGATIVE_VOTE,
1);else if(a===g.NONE_VOTE)this.negativeVoteIcon.removeClass("hasvoted"),this.positiveVoteIcon.removeClass("hasvoted");else return;this.previousVote=a};a.prototype.setContentId=function(a){this.contentId=a};a.prototype.getContentId=function(){return this.contentId};a.prototype.showOrHide=function(a,b,d,f){this.showPositiveVotes=a;this.showNegativeVotes=b;this.showPrompt=d;a?(this.positiveVoteText.addClass("show"),this.positiveVoteIcon.addClass("show")):(this.positiveVoteText.removeClass("show"),this.positiveVoteIcon.removeClass("show"));
b?(this.negativeVoteText.addClass("show"),this.negativeVoteIcon.addClass("show")):(this.negativeVoteText.removeClass("show"),this.negativeVoteIcon.removeClass("show"));d?this.prompt.addClass("show"):this.prompt.removeClass("show");f?this.element.addClass("show"):this.element.removeClass("show")};a.prototype.updateWithNewVote=function(a){if(a===g.POSITIVE_VOTE||a===g.NEGATIVE_VOTE){var b=a==g.POSITIVE_VOTE?g.NEGATIVE_VOTE:g.POSITIVE_VOTE,d=this.getVoteCount(a),f=this.getVoteCount(b);a===this.getPreviousVote()?
(this.setPreviousVote(g.NONE_VOTE),this.setVoteCount(a,d-1)):this.getPreviousVote()!==g.EMPTY_STRING&&this.getPreviousVote()!==g.NONE_VOTE?(this.setVoteCount(b,f-1),this.setVoteCount(a,d+1),this.setPreviousVote(a)):(this.setPreviousVote(a),this.setVoteCount(a,d+1))}};return a}(),K=function(){return function(a,c,e){this.contentId=a;this.positiveVoteCount=c;this.negativeVoteCount=e}}(),z=function(){return function(a){this.name="InvalidArugmentsException";this.message=a}}(),A=function(){function a(c,
b){this.A=c;this.videoVoteConfig=b}a.prototype.createFromContent=function(a,b){a=this.A.$("#"+a).find("[.vse-video-votes][data-contentid\x3d"+b+"]");return new u(a,this.videoVoteConfig)};a.prototype.createFromSelector=function(a){var b=this.A.$(""+a);if(!b)throw new z("VideoVoteContainerFactory can not find selector by the name of "+a+".");return new u(b,this.videoVoteConfig)};a.prototype.sendVoteToRemote=function(a,b,d){var f=this,g=null,h=!1;this.videoVoteConfig.forceTreatment&&(g=[{name:"VSE_VIDEOVOTES_IMAGE_BLOCK_195012",
assignment:"T1"}],h=!0);var k={contentId:d,placement:this.videoVoteConfig.placementContext,positive:a,negative:b,requestId:this.videoVoteConfig.requestId,sessionId:this.videoVoteConfig.sessionId,page:this.videoVoteConfig.page,experimentWeblab:this.videoVoteConfig.experimentWeblab,weblabContext:g,bypassLogin:h};return new this.videoVoteConfig.dependencies.promise(function(a,c){f.A.ajax("/vap/ew/subcomponent/votes/writing",{params:k,paramsFormat:"json",crossDomain:!0,method:"POST",contentType:"application/json",
success:function(c){a(c)},error:function(a){r.count("votecast:failed",1);c(a)}})})};a.prototype.fetchVoteHistory=function(a){var b=this,d=null,f=!1;this.videoVoteConfig.forceTreatment&&(d=[{name:"VSE_VIDEOVOTES_IMAGE_BLOCK_195012",assignment:"T1"}],f=!0);var g={contentId:a,placement:this.videoVoteConfig.placementContext,requestId:this.videoVoteConfig.requestId,sessionId:this.videoVoteConfig.sessionId,page:this.videoVoteConfig.page,experimentWeblab:this.videoVoteConfig.experimentWeblab,weblabContext:d,
bypassLogin:f};return new this.videoVoteConfig.dependencies.promise(function(a,c){b.A.ajax("/vap/ew/subcomponent/votes/status",{params:g,paramsFormat:"json",crossDomain:!0,method:"POST",contentType:"application/json",success:function(c){a(c)},error:function(a){r.count("votehistory:failed",1);c(a)}})})};a.prototype.convertPayloadToVoteData=function(a){var b=[],d;for(d in a)a.hasOwnProperty(d)&&b.push(new K(d,a[d].positive,a[d].negative));return b};a.prototype.fetchVoteCounts=function(a){var b=this,
d=null,f=!1;this.videoVoteConfig.forceTreatment&&(d=[{name:"VSE_VIDEOVOTES_IMAGE_BLOCK_195012",assignment:"T1"}],f=!0);var g={contentIds:a,placement:this.videoVoteConfig.placementContext,requestId:this.videoVoteConfig.requestId,sessionId:this.videoVoteConfig.sessionId,page:this.videoVoteConfig.page,experimentWeblab:this.videoVoteConfig.experimentWeblab,weblabContext:d,bypassLogin:f};return new this.videoVoteConfig.dependencies.promise(function(a,c){b.A.ajax("/vap/ew/subcomponent/votes",{params:g,
paramsFormat:"json",crossDomain:!0,method:"POST",contentType:"application/json",success:function(d){d=b.convertPayloadToVoteData(d);0<d.length&&a(d);c(d)},error:function(a){r.count("votegetcounts:failed",1);c(a)}})})};return a}(),L=function(){function a(c,b,d,f,k){var h=this;this.carouselFramework=b;this.A=d;this.contentCarouselConfig=f;this.deps=k;this.vseAssets=[];this.vseAssetIndex={};this.voteContainerIndex={};this.carouselPageSize=0;this.carouselPageNumber=1;this.getplaylist=function(){return h.vseAssets.slice()};
this.getActiveAsset=function(){return h.activeAsset};this.scrollTo=function(){h.A.$("#"+h.contentCarouselConfig.carouselName).animate({scrollTop:h.activeCard.offset().top-h.A.$("#"+h.contentCarouselConfig.carouselName).offset().top+h.A.$("#"+h.contentCarouselConfig.carouselName).scrollTop()})};this.rotateTo=function(a){h.markPlaying(a);h.contentCarouselConfig.isVerticalScroll&&h.scrollTo();0!==h.carouselPageSize&&(a=h.findIndex(a),-1!==a&&(a=Math.floor(a/h.carouselPageSize)+1,h.carouselPageNumber!=
a&&h.auiCarousel.gotoPage(a)))};this.markPlaying=function(a){h.activeAsset=a;h.activeCard.removeClass("active");h.activeCard=h.vseAssetIndex[a.contentId].$el.closest("li").addClass("active")};this.findIndex=function(a){return h.vseAssets.indexOf(h.vseAssetIndex[a.contentId])};this.emitRefTag=function(a,c,b){0<h.listOffset&&(a=(a-h.listOffset+h.vseAssets.length)%h.vseAssets.length);h.refTagRecorder.emitRefTag(c+a,b)};this.destroy=function(){h.A.$("#"+h.contentCarouselConfig.carouselName+" .a-carousel-card.active").removeClass("active")};
this.updateVotingElements=function(a,c){h.A.each(a,function(a){var b=h.vseAssetIndex[a.contentId].videoVoteContainer;b.setVoteCount(g.POSITIVE_VOTE,a.positiveVoteCount);b.setVoteCount(g.NEGATIVE_VOTE,a.negativeVoteCount);b.countsFetched=!0;b.showOrHide(c,c,!1,c)})};this.getAssetSpec=function(a,c,b){var e=a.data(),d=a.find(".vse-video-image").data("img"),d=d.replace("SR160,90_BG0,0,0_PKvse-overlay-play2","").replace("SR320,180_BG0,0,0_PKvse-overlay-play2","");return{contentId:e.asin,title:e.title,
vendorName:e.vendorName,vendorCode:e.vendorCode,referenceUrl:e.referenceUrl,referenceLinkTitle:e.referenceTitle,videoUrl:e.videoUrl,$el:a,duration:e.duration,imageUrl:d,sponsored:e.sponsored,enableAssociateTag:e.enableAssociateTag,videoVoteContainer:h.voteContainerIndex[e.asin],productAsin:e.productAsin,refTag:b+c}};var l=d.$;this.activeCard=l([]);var m=this;this.auiCarousel=c;this.refTagRecorder=new J(d);l("#"+f.carouselName).find(".a-carousel-heading").after(l("#"+f.carouselName).find(".vse-upload-link").removeClass("aok-hidden"));
l("#"+f.carouselName+" .vse-video-item").each(function(a){a=m.getAssetSpec(l(this),a,m.contentCarouselConfig.refTagPrefix);m.vseAssets.push(a);m.vseAssetIndex[a.contentId]=a});f.videoVoteConfig&&(this.videoVoteContainerFactory=new A(d,f.videoVoteConfig),d.each(this.vseAssetIndex,function(a){h.voteContainerIndex[a.contentId]=h.videoVoteContainerFactory.createFromContent(h.contentCarouselConfig.carouselName,a.contentId);a.videoVoteContainer=h.voteContainerIndex[a.contentId]}));f.showAdPlacement||l("#"+
f.carouselName).delegate(".a-carousel-card a","click",function(a){if(l(this).closest("li").hasClass("active"))a.preventDefault();else{var c=m.vseAssetIndex[l(this).closest("li").find(".vse-video-item").data("asin")];m.markPlaying(c);c.eventTimestamp=Date.now();d.trigger("vse:contentCarousel:"+f.carouselName+":click",c);var b=m.findIndex(c);m.emitRefTag(b,m.contentCarouselConfig.refTagPrefix,c);f.isPreventDefault&&a.preventDefault()}});l("#"+f.carouselName+" .vse-carousel-item").each(function(a){var c=
l(this);if(f.showAdPlacement){c.attr("href",c.data("redirect-url")+"?ref\x3ddp_vse_rva1_pc");var b=c.parent().data("asin");c.parent().delegate(".vse-carousel-item","click",function(a){d.trigger("vse:rva:carousel:"+f.carouselName+":productClick",{relatedProductAsin:b,name:"vse.related_video_advertising.productClick"})})}else c.attr("href",c.data("redirect-url")+"?ref\x3d"+m.contentCarouselConfig.refTagPrefix+a)});d.off("a:carousel:"+f.carouselName+":change:pageSize");d.off("a:carousel:"+f.carouselName+
":change:pageNumber");d.on("a:carousel:"+f.carouselName+":change:pageSize",function(){h.carouselPageSize=h.auiCarousel.getAttr("pageSize");h.activeAsset&&h.rotateTo(h.activeAsset)});d.trigger("a:carousel:"+f.carouselName+":change:pageSize");d.on("a:carousel:"+f.carouselName+":change:pageNumber",function(){h.carouselPageNumber=h.auiCarousel.getAttr("pageNumber");d.trigger("a:carousel:"+f.carouselName+":scrollCarousel",h.carouselPageNumber,h.carouselPageSize)});d.trigger("a:carousel:"+f.carouselName+
":updatePageIndex",this.carouselPageNumber,this.carouselPageSize)}a.prototype.changeStartingCardTo=function(a){var b=this,d=this;this.A.$("#"+this.contentCarouselConfig.carouselName+" .vse-carousel-item").each(function(a){var c=d.A.$(this);a=(a-d.listOffset+d.vseAssets.length)%d.vseAssets.length;c.attr("href",c.data("redirect-url")+"?ref\x3d"+d.contentCarouselConfig.refTagPrefix+a)});this.listOffset=this.findIndex(a);this.contentCarouselConfig.isVerticalScroll||(this.carouselFramework.initializeAll(),
this.carouselFramework.onInit(""+this.contentCarouselConfig.carouselName,function(){b.rotateTo(a)}))};return a}(),M=function(){function a(c,b,d){this.carouselFramework=c;this.A=b;this.deps=d}a.prototype.create=function(a){var b=this.carouselFramework.getCarousel(this.A.$("#"+a.carouselName));if(!b)throw new z("Carousel framework can not find carousel by the name of "+a.carouselName+".");return new L(b,this.carouselFramework,this.A,a,this.deps)};return a}(),q=function(){function a(){}a.ELM_OTHER_OPTION=
".vse-fb-other";a.ELM_RBTN_CHECKED='input[name\x3d"FeedbackInput"]:checked';a.ELM_CHECKBOX_CHECKED='input[type\x3d"checkbox"]:checked';a.DATA_REQ_MSG="requiredcommentmessage";a.DATA_OPTIONAL_MSG="optionalcommentmessage";a.ATTR_NAME_PLACEHOLDER="placeholder";return a}(),B=n,C=n;m.when("a-sheet").execute(function(a){B=a});m.when("a-popover").execute(function(a){C=a});var D={getBottomSheet:function(){return B},getPopoverFactory:function(){return C}},N=function(){function a(c){var b=this;this.config=
c;this.activeVideoSource=this.activeVideo="VIDEO_NOT_SELECTED";this.isOtherSelected=this.registered=!1;this.setBottomSheetHeight=!0;this.internalRejectedVideo=!1;this.defaultBottomSheetHeight=400;this._submitErrorCallback=function(a){b.A.trigger("vse:"+b.id+":feedback:submitted:error")};this._submitSuccessCallback=function(a){b.A.trigger("vse:"+b.id+":feedback:submitted:success")};this.A=c.A;this.pageStateName=c.pageStateName;this.buttonApi=c.buttonApi;this.id=this.config.id;this.A.state.parse();
this.A.state.replace(this.pageStateName,JSON.parse(this.A.$("script[type\x3d'a-state'][data-a-state*\x3d"+this.pageStateName+"]").html()));c=this.A.state(this.pageStateName);this.feedbackSection=this.A.$("#"+this.id);this.feedbackForm=this.A.$("#"+this.id+"-form");this.commentBox=this.A.$("#"+this.id+"-comment-box");this.requiredCommentMessage=this.commentBox.parent().data(q.DATA_REQ_MSG);this.optionalCommentMessage=this.commentBox.parent().data(q.DATA_OPTIONAL_MSG);this.thankYouSection=this.A.$("#"+
this.id+"-ty-container");this.submitButton=this.buttonApi("#"+this.id+"-btn-submit");this.cancelButton=this.A.$("#"+this.id+"-btn-cancel");c&&this.validateFormElements()&&(this.isMobile=c.isMobile,this.endpoint=c.feedbackEndpoint,this.isInternal=c.isInternal,this.marketplaceId=c.marketplaceId,this.pageAsin=c.pageAsin,this.customerId=c.customerId,this.bottomSheetFactory=D.getBottomSheet(),this.popoverFactory=D.getPopoverFactory(),this.registered||(this.A.declarative(this.id+"-options-choose","click",
function(a){b.activeSelectionEvent=a;b.A.$(a)&&b.A.$(a.$target)&&(b.currentViolations=b.A.$(a.$target).closest(".vse-fb-option").find("input").val());b.otherSection=a.$target.closest(q.ELM_OTHER_OPTION);1===b.otherSection.length?(b.updatePlaceholderString(b.requiredCommentMessage),b.isOtherSelected=!0):(b.isOtherSelected=!1,b.updatePlaceholderString(b.optionalCommentMessage));b.submitButton.enable()}),this.A.declarative(this.id+"-andoncord-check","change",function(a){b.internalRejectedVideo=a.$target.is(":checked")}),
this.A.declarative(this.id+"-btn-close","click",function(){return b.closeFeedbackForm()}),this.A.declarative(this.id+"-btn-cancel","click",function(){return b.cancelFeedbackForm()}),this.A.declarative(this.id+"-btn-submit","click",function(){return b.submitFeedback()}),this.A.on("a:sheet:afterShow:"+this.id+"-sheet",function(a){b.defaultBottomSheetHeight=.75*b.A.$(l).height();b.changeBottomSheetHeight(a,b.defaultBottomSheetHeight);b.showFeedbackForm()}),this.A.on("a:sheet:afterHide:"+this.id+"-sheet",
function(a){b.resetFeedbackForm().hideThankYou();b.A.trigger("vse:"+b.id+":feedback:hidden")}),this.A.on("a:popover:afterShow:"+this.id+"-popover",function(a){b.showFeedbackForm()}),this.A.on("a:popover:afterHide:"+this.id+"-popover",function(a){b.hideFeedbackForm()}),this.registered=!0))}a.prototype.showFeedbackForm=function(a){this.A.trigger("vse:"+this.id+":feedback:shown");return this};a.prototype.hideFeedbackForm=function(){this.isMobile?this.getAndSetBottomSheetInstance()&&this.bottomSheetInstance.hide():
this.getAndSetPopoverInstance()&&this.popoverInstance.hide();this.resetFeedbackForm().hideThankYou();this.A.trigger("vse:"+this.id+":feedback:hidden");return this};a.prototype.setActiveVideoAndSource=function(a,b){this.activeVideo=a;this.activeVideoSource=b};a.prototype.submitFeedback=function(){if(this.isOtherSelected&&this.commentBox&&""===this.commentBox.val())this.commentBox.focus();else{var a={events:[{data:{feedback:{additionalComments:this.commentBox?this.commentBox.val():"",playerVersion:"",
asin:this.pageAsin,videoId:this.activeVideo,videoSource:this.activeVideoSource,violations:this.currentViolations,url:document.location.href,userAgent:l.navigator&&l.navigator.userAgent?l.navigator.userAgent:"window.navigator.userAgent not supported",feedbackTime:this.A.now(),customerId:this.customerId,isInternal:this.isInternal,feedbackWidgetVersion:"2",marketplace:this.marketplaceId,internalRejectedVideo:this.internalRejectedVideo}}}]};this.A.$.ajax({url:this.endpoint,data:JSON.stringify(a),type:"POST",
contentType:"application/json; charset\x3dutf-8",error:this._submitErrorCallback,success:this._submitSuccessCallback});this.A.trigger("vse:"+this.id+":feedback:submitted");this.resetFeedbackForm().showThankYou()}};a.prototype.cancelFeedbackForm=function(){this.resetFeedbackForm();this.A.trigger("vse:"+this.id+":feedback:cancelled")};a.prototype.closeFeedbackForm=function(){this.hideFeedbackForm();this.A.trigger("vse:"+this.id+":feedback:closed")};a.prototype.resetFeedbackForm=function(){this.submitButton.disable();
this.feedbackSection.find(q.ELM_RBTN_CHECKED).each(function(){this.checked=!1});this.updatePlaceholderString(this.optionalCommentMessage);this.commentBox.val("");this.internalRejectedVideo=!1;this.feedbackSection.find(q.ELM_CHECKBOX_CHECKED).each(function(){this.checked=!1});return this};a.prototype.showThankYou=function(){this.feedbackForm.fadeOut(200);this.thankYouSection.addClass("show").removeClass("aok-hidden").fadeIn(400);this.A.trigger("vse:"+this.id+":thank-you:shown");return this};a.prototype.hideThankYou=
function(){this.feedbackForm.fadeIn(10);this.thankYouSection.addClass("aok-hidden").removeClass("show").fadeOut(10);this.A.trigger("vse:"+this.id+":thank-you:hidden");return this};a.prototype.validateFormElements=function(){return this.feedbackSection.length&&this.commentBox.length&&this.thankYouSection.length&&this.submitButton.size()&&this.cancelButton.length&&this.feedbackForm.length};a.prototype.updatePlaceholderString=function(a){this.commentBox.attr(q.ATTR_NAME_PLACEHOLDER,a)};a.prototype.changeBottomSheetHeight=
function(a,b){this.setBottomSheetHeight&&(a.sheet.changeHeight({duration:.3,height:b}),this.setBottomSheetHeight=!1)};a.prototype.getAndSetBottomSheetInstance=function(){return this.bottomSheetFactory?this.bottomSheetInstance?this.bottomSheetInstance:this.bottomSheetInstance=this.bottomSheetFactory.get(this.id+"-sheet"):n};a.prototype.getAndSetPopoverInstance=function(){return this.popoverFactory?this.popoverInstance?this.popoverInstance:this.popoverInstance=this.popoverFactory.get(this.id+"-popover"):
n};return a}(),O=function(){function a(b){this.config=b;this.feedbackWidgets={}}a.prototype.create=function(a,b){b=this.feedbackWidgets[a]||new N({id:a,pageStateName:b,A:this.config.A,buttonApi:this.config.buttonApi});return this.feedbackWidgets[a]=b};a.prototype.get=function(a){return this.feedbackWidgets[a]};return a}(),k=function(){function a(){}a.WIDTH_ASPECT_RATIO=1.77;a.EMPTY_STRING="";a.ibMetadata=".vse-ib-metadata";a.metaDataContainer=".vse-md-container";a.metaDataCustomerProfile=".vse-md-customer-profile";
a.videoInformationContainer=".vse-md-container .vse-md-title .vse-title";a.titlePrefixContainer=".vse-md-container .vse-md-title .vse-title-prefix";a.currentItemPrefixContainer=".vse-video-title-prefix-text";a.reviewStarContainer=".vse-md-container .vse-reviewstar-container";a.reviewTextContainer=".vse-md-container .vse-reviewText-container";a.ceVideoElement="vse-content-experiment-video";a.mobileMovableContainer=".vse-vb-movable-container";a.mobileFixedContainer=".vse-mobile-fixed-container";a.videoPlayerContainer=
".vse-airy-container";a.vendorCRCode="AOD60";return a}(),a={vars:{A:{},isMobile:!1,relatedVideosCarousel:null,newHref:"",newrefTag:"dp_vse_ib",activeVideoVoteContainer:null,sushiMetricsConfig:null,buildSushiPayload:null,videoVoteContainerFactory:null,isContentExperiment:!1,showVotes:!1,forceMobileResize:!1,ibCarouselName:"#vse-ib-rvs",playerInstance:null,isMshop:!1,mShopFactory:null},resizeMobilePopover:function(){var b=a.vars.A.$,c=b(l).height();if(a.vars.isContentExperiment||a.vars.forceMobileResize){var e=
b(k.mobileFixedContainer).outerHeight(!0);b(k.mobileMovableContainer).css({"max-height":c-e,top:e});b(a.vars.ibCarouselName).removeAttr("style")}else{var e=b(k.videoPlayerContainer).outerHeight(!0)+b(".immersive-view-back-button").outerHeight(!0)+b(".vse-md-container").outerHeight(!0),d=b(k.mobileFixedContainer).outerHeight(!0);b(a.vars.ibCarouselName).css({"max-height":c-d,top:e})}},resizeImmersiveView:function(){var b=a.vars.A.$("#ivVideoBlock"),c=a.vars.A.$("#ivVideosTab").height();b.css("height",
c);var e=b.find(".vse-video-block"),d=c-a.getDimension(b,"padding-top")-a.getDimension(b,"padding-bottom");e.css({"max-height":c,overflow:"hidden"});c=b.find(k.videoPlayerContainer);b=b.find(k.ibMetadata);d=Math.floor(d-a.getDimension(b,"height"));e=Math.floor(d*k.WIDTH_ASPECT_RATIO);c.css({"max-height":d,"max-width":e});b.css("max-width",e)},updateCustomerProfileAndReview:function(b){var c=a.vars.A.$(a.vars.ibCarouselName).find('[data-asin\x3d"'+b.contentId+'"]'),e=a.vars.A.$(k.metaDataContainer).find(k.metaDataCustomerProfile);
a.vars.A.$(k.reviewStarContainer).children().remove();a.vars.A.$(k.reviewTextContainer).children().remove();a.vars.A.$(k.titlePrefixContainer).text("");e.children().remove();if(c.find(".vse-review-stars").length){var d=c.find(".vse-review-stars").clone(),f=c.find(".vse-review-text").clone();a.vars.A.$(k.reviewStarContainer).append(d);a.vars.A.$(k.reviewTextContainer).prepend(f);a.vars.isMobile&&a.vars.A.$(k.titlePrefixContainer).text(c.find(k.currentItemPrefixContainer).text())}0<c.find(".vse-video-customer-profile").length?
(a.vars.A.$(k.ibMetadata).removeClass("vse-ib-profile-hidden"),b=c.find(".vse-video-customer-profile").clone().removeClass("aok-hidden vse-hidden"),e.append(b),e.find(".a-profile-avatar img").attr("src",c.find(".a-profile-avatar img").attr("data-src")),a.vars.A.$(k.ibMetadata).find(".vse-md-vendor-name").hide()):(a.vars.A.$(k.ibMetadata).addClass("vse-ib-profile-hidden"),a.vars.A.$(k.ibMetadata).find(".vse-md-vendor-name").text(b.vendorName).show())},updateMediaInfo:function(b){a.vars.A.$(k.videoInformationContainer).text(b.title);
a.vars.A.$(k.ibMetadata).hasClass("vse-ib-customer-review")&&a.updateCustomerProfileAndReview(b);a.vars.showVotes&&(a.updateActiveVideoVoteContainer(b),a.vars.activeVideoVoteContainer.showOrHide(!0,!0,!0,!0));a.vars.isMobile?a.resizeMobilePopover():a.resizeImmersiveView()},updateActiveVideoVoteContainer:function(b){a.vars.showVotes&&(a.vars.activeVideoVoteContainer.setContentId(b.contentId),a.vars.activeVideoVoteContainer.setVoteCount(g.POSITIVE_VOTE,b.videoVoteContainer.getVoteCount(g.POSITIVE_VOTE)),
a.vars.activeVideoVoteContainer.setVoteCount(g.NEGATIVE_VOTE,b.videoVoteContainer.getVoteCount(g.NEGATIVE_VOTE)),a.fetchAndUpdateVotingCount(),a.fetchAndUpdateVotingHistory())},castVote:function(b){if(a.vars.videoVoteContainerFactory&&a.vars.videoVoteContainerFactory.videoVoteConfig){var c=a.vars.activeVideoVoteContainer.getPreviousVote(),e=b===g.POSITIVE_VOTE&&c!=g.POSITIVE_VOTE,c=b===g.NEGATIVE_VOTE&&c!=g.NEGATIVE_VOTE;a.vars.activeVideoVoteContainer.updateWithNewVote(b);a.vars.videoVoteContainerFactory.sendVoteToRemote(e,
c,a.vars.activeVideoVoteContainer.getContentId()).then(function(c){a.vars.videoVoteContainerFactory&&a.vars.videoVoteContainerFactory.videoVoteConfig&&a.vars.A.trigger(a.vars.videoVoteContainerFactory.videoVoteConfig.actionPrefix+"-vote-cast",b)},function(c){r.count("ibiv.videovote.votecastfailure",1);a.vars.activeVideoVoteContainer.updateWithNewVote(b)})}},getDimension:function(a,c){a=parseInt(a.css(c),10);return isNaN(a)?0:a},isDefined:function(a){return"undefined"!==typeof a&&null!==a},appendDivider:function(b,
c){var e=a.vars.A.$(".vse-video-block .vse-ib-divider-header-string").text()+(" ("+b+")");a.vars.A.$(".vse-video-block .vse-ib-divider-header-string").text(e);e=a.vars.A.$(".vse-video-block .vse-ib-divider-header-string");c.length>b&&a.vars.A.$(c[c.length-b-1]).append(e);e.removeClass("aok-hidden")},fetchAndUpdateVotingHistory:function(){var b=a.vars.relatedVideosCarousel.getActiveAsset();b.videoVoteContainer&&(b.videoVoteContainer.getPreviousVote()!==g.EMPTY_STRING?a.vars.activeVideoVoteContainer.setPreviousVote(b.videoVoteContainer.getPreviousVote()):
a.vars.videoVoteContainerFactory.fetchVoteHistory(b.contentId).then(function(c){a.vars.videoVoteContainerFactory===n||c!==g.POSITIVE_VOTE&&c!==g.NEGATIVE_VOTE&&c!==g.NONE_VOTE||(a.vars.activeVideoVoteContainer.setPreviousVote(c),b.videoVoteContainer.setPreviousVote(c))},function(a){r.count("ibiv.videovote.votehistoryfailure",1)}))},fetchAndUpdateVotingCount:function(){var b=a.vars.relatedVideosCarousel.getActiveAsset();b.videoVoteContainer&&!b.videoVoteContainer.countsFetched&&a.vars.videoVoteContainerFactory.fetchVoteCounts([b.contentId]).then(function(c){a.vars.relatedVideosCarousel.updateVotingElements(c,
!1);for(var e=0;e<c.length;e++)if(c[e].contentId===b.contentId){b.videoVoteContainer.setVoteCount(g.POSITIVE_VOTE,c[e].positiveVoteCount);b.videoVoteContainer.setVoteCount(g.NEGATIVE_VOTE,c[e].negativeVoteCount);b.videoVoteContainer.countsFetched=!0;break}a.vars.activeVideoVoteContainer.countsFetched=!0;a.vars.activeVideoVoteContainer.showOrHide(!0,!0,!0,!0);a.vars.isMobile?a.resizeMobilePopover():a.resizeImmersiveView()},function(b){r.count("ibiv.videovote.votecountfailure",1);a.vars.A.trigger(a.vars.videoVoteContainerFactory.videoVoteConfig.actionPrefix+
"-hide-votes")})}},P=function(){function b(a,b){this.brilaFactory=a;this.config=b}b.prototype.embed=function(){var a=this,b=document.getElementById(this.config.parentId),d=this.config.parentId+"-element",f=document.createElement("video");f.id=d;f.className="video-js";f.setAttribute("playsinline","true");this.config.shouldDisableControls||f.setAttribute("controls","true");this.config.shouldAutoplay&&f.setAttribute("autoplay","true");this.config.shouldStartMuted&&f.setAttribute("muted","true");b.appendChild(f);
this.videoJS=this.brilaFactory.embed(d,this.config);document.getElementById(d).setAttribute("style","width:100%; height:100%;");this.videoJS.src(this.config.mediaSourceInfo[0]);this.vseMetrics=this.brilaFactory.metrics(this.videoJS);this.config.videoAds.isEngineEnabled&&(this.vseAds=this.brilaFactory.ads(this.videoJS));this.videoJS.on("play",function(){a.config.bindings.play()});this.videoJS.on("firstplay",function(){a.config.bindings.play()});this.videoJS.on("fullscreenchange",function(){a.videoJS.isFullscreen()?
a.config.bindings.fullscreen():a.config.bindings.normalscreen()});return this.wrapper()};b.prototype.wrapper=function(){var b=this;return{attach:function(a){},isFullScreen:function(){return b.videoJS.isFullscreen()},enterFullScreen:function(){b.videoJS.requestFullscreen()},enterFullWindow:function(){b.videoJS.enterFullWindow()},enterNormalScreen:function(){b.videoJS.exitFullscreen()},play:function(e){a.isDefined(e)&&a.isDefined(e.eventTimestamp)&&b.vseMetrics.setPageLoadStartTimestamp(e.eventTimestamp);
return b.videoJS.play()},pause:function(){b.videoJS.pause()},loadMedia:function(a){var d=a.contentId,f=a.mediaSourceInfo[0];a=a.refTag?a.refTag:"";b.vseMetrics.setRefTag&&b.vseMetrics.setRefTag(a);b.vseMetrics.setContentId&&b.vseMetrics.setContentId(d);b.config.videoAds.isEngineEnabled&&b.vseAds.setContentId(d);b.videoJS.src(f)},destroy:function(){b.videoJS.dispose()}}};return b}();try{var S=function(b){return new b(function(b,e){m.when("A","a-carousel-framework","3p-promise","a-button","ready").register("VSECommonComponentAssets",
function(d,e,n,h){var p,q,x,v,u;a.vars.A=d;var t;a.vars.A.on("vseAiry",function(){m.when("mash").execute("NilgiriService-Mash-Detection",function(b){a.vars.A.$(".vse-video-block").addClass("mshop");a.isMshop=!0;a.mShopFactory=b})});a.vars.A.on.orientationchange(function(b){if(0===b.orientation){b=b.height;var c=a.vars.A.$(k.mobileFixedContainer).outerHeight(!0);a.vars.A.$("#"+q).css({"max-height":b-c,top:c})}});return{initCarousel:function(){try{a.vars.A.state.parse();a.vars.A.state.replace("dp_vse_rvc",
JSON.parse(a.vars.A.$("script[type\x3d'a-state'][data-a-state*\x3ddp_vse_rvc]").html()));var b=a.vars.A.state("dp_vse_rvc");if(b){var c={gatedP:y,promise:n},h=new M(e,d,c);e.createAll();e.initializeAll();a.vars.relatedVideosCarousel=h.create(b);a.vars.ibCarouselName="#"+b.carouselName;var m=d.$.extend({},b.videoVoteConfig);m.hasOwnProperty("placementContext")&&(m.dependencies=c,a.vars.videoVoteContainerFactory=new A(d,m),a.vars.activeVideoVoteContainer=a.vars.videoVoteContainerFactory.createFromSelector("#vse-video-votes-lb-details-"+
m.placementContext));q=b.carouselName;var w=a.vars.A.$(a.vars.ibCarouselName).find("."+k.ceVideoElement).parent("li");a.vars.isContentExperiment=0<w.length;if(a.vars.isContentExperiment){w.closest(a.vars.ibCarouselName).addClass(k.ceVideoElement+"-container");u=a.vars.A.$(a.vars.ibCarouselName+" ol.a-carousel li");var t=w.length;w.each(function(b,c){a.vars.A.$(k.ibMetadata).addClass("vse-ib-customer-review")});a.appendDivider(t,u)}else if(a.vars.isMobile){var R=a.vars.A.$(a.vars.ibCarouselName).closest(""+
k.mobileMovableContainer);a.vars.forceMobileResize=0<R.length}a.vars.A.on("vse:contentCarousel:"+q+":click",function(b){var c={mediaSourceInfo:[b.videoUrl],contentId:b.contentId,refTag:b.refTag?b.refTag:""};a.isDefined(a.playerInstance)&&(a.playerInstance.attach(p),a.playerInstance.loadMedia(c),a.playerInstance.play({isAsync:!0,eventTimestamp:(new Date).getTime()}),a.updateMediaInfo(b),a.isDefined(v)&&v.setActiveVideoAndSource(b.contentId,b.vendorCode))});var E=a.vars.relatedVideosCarousel.getplaylist()[0];
a.vars.relatedVideosCarousel.markPlaying(E);var F=a.vars.relatedVideosCarousel.getActiveAsset();a.vars.showVotes=a.vars.videoVoteContainerFactory&&a.vars.videoVoteContainerFactory.videoVoteConfig&&F&&F.videoVoteContainer&&!a.vars.videoVoteFailure&&(a.vars.isMobile||!a.vars.isContentExperiment);a.vars.showVotes&&(a.updateActiveVideoVoteContainer(a.vars.relatedVideosCarousel.getActiveAsset()),a.vars.A.on(a.vars.videoVoteContainerFactory.videoVoteConfig.actionPrefix+"-hide-votes",function(){a.vars.activeVideoVoteContainer.showOrHide(!1,
!1,!1,!1);a.vars.videoVoteFailure=!0}),a.vars.A.declarative(a.vars.videoVoteContainerFactory.videoVoteConfig.actionPrefix+"-vote-positive","click",function(){a.castVote(g.POSITIVE_VOTE)}),a.vars.A.declarative(a.vars.videoVoteContainerFactory.videoVoteConfig.actionPrefix+"-vote-negative","click",function(){a.castVote(g.NEGATIVE_VOTE)}),a.vars.A.on(a.vars.videoVoteContainerFactory.videoVoteConfig.actionPrefix+"-vote-cast",function(b){var c=b===g.POSITIVE_VOTE?g.NEGATIVE_VOTE:g.POSITIVE_VOTE,d=a.vars.relatedVideosCarousel.getActiveAsset(),
e=g.EMPTY_STRING;d&&d.videoVoteContainer&&(e=d.videoVoteContainer.getPreviousVote()===b?"cancel:"+b:d.videoVoteContainer.getPreviousVote()===g.POSITIVE_VOTE||d.videoVoteContainer.getPreviousVote()===g.NEGATIVE_VOTE?"switch-"+c+"-to-"+b:b,d.videoVoteContainer.updateWithNewVote(b));a.vars.sushiMetricsConfig&&a.vars.sushiMetricsConfig.endpoint!==k.EMPTY_STRING&&(b=a.vars.buildSushiPayload({eventName:"ibiv.videovote.castvote:"+e,stringPayload:k.EMPTY_STRING,intPayload:1,videoAsin:d.contentId}),r.emitSushiMetric(b,
a.vars.sushiMetricsConfig.endpoint))}));a.vars.isMobile&&a.updateMediaInfo(E)}}catch(Q){l.ueLogError&&l.ueLogError(Q,{logLevel:"FATAL",attribution:"vse-nilgiri-service",message:"InitializeVSECarousel: "})}},initPlayer:function(){try{var b=!1;a.vars.A.state.parse();a.vars.A.state.replace("vse_dp_airy",JSON.parse(a.vars.A.$("script[type\x3d'a-state'][data-a-state*\x3dvse_dp_airy]").html()));var c=a.vars.A.state("vse_dp_airy");if(c){t={onScreenChange:function(){b=!1;a.vars.A.trigger("vsePlayerScreenChange",
b)},onFullScreen:function(){b=!0},onPlay:function(){a.isDefined(a.playerInstance)&&"true"===e.enableFullScreenByDefault.toLowerCase()&&!a.playerInstance.isFullScreen()&&a.playerInstance.enterFullScreen({isAsync:!0})}};var d=c.foresterConfiguration,e=c.playerConfiguration;a.vars.isMobile=c.isMobile;var f={contentId:d.contentId,customerId:c.sushiMetricsConfig.customerId,foresterMetadataParams:{client:d.client,marketplaceId:d.marketplaceId,method:d.method,requestId:d.requestId,session:d.sessionId},mediaSourceInfo:[c.videoUrl],
pageAsin:d.pageAsin,parentId:c.id,bindings:{play:function(){return t.onPlay()},normalscreen:function(){return t.onScreenChange()},fullscreen:function(){return t.onFullScreen()}}};c.sushiMetricsConfig&&c.sushiMetricsConfig.endpoint!==k.EMPTY_STRING&&(f.sushiMetricsConfig=c.sushiMetricsConfig);a.vars.A.on("a:popover:afterShow:video-immersive-view",function(){a.vars.A.$("body").addClass("vse-lb-no-scroll");a.isMshop&&a.isDefined(a.mShopFactory)&&a.mShopFactory.dispatchEvent({type:"appOverlays.Hide"})});
a.vars.A.on("a:popover:beforeHide:video-immersive-view",function(){a.vars.A.$("body").removeClass("vse-lb-no-scroll");a.isMshop&&a.isDefined(a.mShopFactory)&&a.mShopFactory.dispatchEvent({type:"appOverlays.Show"})});p=c.id;m.when("brila").execute("NS-Brila-Player",function(b){a.isDefined(a.playerInstance)&&"function"===typeof a.playerInstance.destroy&&a.playerInstance.destroy();var c=a.vars.A.$.extend({},f,{videoAds:{isEngineEnabled:!1},shouldStartMuted:!1,shouldAutoplay:!1,shouldDisableControls:!1});
b=new P(b,c);a.playerInstance=b.embed();a.vars.A.trigger("vseAiry",{airy:a.playerInstance,containerId:p});a.vars.A.declarative("a-secondary-view","click touch",function(b){"video-immersive-view"===b.data.name&&a.isDefined(a.playerInstance)&&!a.playerInstance.isFullScreen()&&(x=a.vars.A.$("#image-block li .vse-video-element").closest("a.video-data-wrapper").data(),("true"===e.enableFullScreenByDefault.toLowerCase()||a.isDefined(x)&&1===x.videoCount)&&a.playerInstance.enterFullScreen())})});var h=a.vars.A.$("#div-feedback");
a.vars.A.$(".vse-md-details").append(h);var g=I.fetchLatestPageState(a.vars.A,"videoInformation-vse_ib_iv");g&&g.sushiMetricsConfig&&(a.vars.sushiMetricsConfig=g.sushiMetricsConfig,a.vars.buildSushiPayload=H.makeApplicationSushiPayloadBuilder(a.vars.A,a.vars.sushiMetricsConfig))}}catch(n){l.ueLogError&&l.ueLogError(n,{logLevel:"FATAL",attribution:"vse-nilgiri-service",message:"InitializePlayer: "})}},initFeedback:function(){try{v=(new O({A:d,buttonApi:h})).create("vse_ib_iv-feedback","vse_ib_iv-feedback");
var b=a.vars.A.state("vse_dp_airy").foresterConfiguration.contentId,c=a.vars.A.state("vse_dp_airy").vendorCode;v.setActiveVideoAndSource(b,c);a.vars.A.on("vse:vse_ib_iv-feedback:feedback:shown",function(){a.playerInstance.pause()});a.vars.A.on("vse:vse_ib_iv-feedback:feedback:hidden",function(){a.playerInstance.play();a.isMshop&&a.isDefined(a.mShopFactory)&&d.delay(function(){a.mShopFactory.dispatchEvent({type:"appOverlays.Hide"})},500)})}catch(e){l.ueLogError&&l.ueLogError(e,{logLevel:"FATAL",attribution:"vse-nilgiri-service",
message:"InitializeVSEFeedback: "})}},_noneFeature:b()}})})};m.when("A","3p-promise").execute("VSE-gatedP-register-ns-client",function(a,c){y.register("VSECommonComponentAssets","VSE-NS-client-registered",S,c)})}catch(b){l.ueLogError&&l.ueLogError(b,{logLevel:"ERROR",attribution:"vse-nilgiri-service",message:"NSE: "})}})()});